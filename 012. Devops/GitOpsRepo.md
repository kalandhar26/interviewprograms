# Kubernetes GitOps Repository Structure

The following table outlines the purpose, functionality, and common use cases for each file and folder in the
`k8s-gitops-repo/` structure. This repository uses Kustomize for managing Kubernetes manifests and ArgoCD for
GitOps-based deployments in a microservices architecture on AWS EKS.

| File/Folder                                                          | Purpose & What it Does                                                                                                     | Common Use Cases & Notes                                                                  |
|----------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------|
| **k8s-gitops-repo/**                                                 | Root directory for the GitOps repository, organizing manifests for applications, infrastructure, ArgoCD, and environments. | Centralizes all Kubernetes manifests and configurations for GitOps workflows with ArgoCD. |
| **applications/**                                                    | Directory containing manifests for individual microservices (e.g., user-service, payment-service, gateway-service).        | Organizes service-specific configurations for modularity and maintainability.             |
| **applications/user-service/**                                       | Directory for user-service manifests, split into base and environment-specific overlays.                                   | Manages all Kubernetes resources for the user-service microservice across environments.   |
| **applications/user-service/base/**                                  | Contains base Kubernetes manifests for user-service, defining core configurations.                                         | Provides reusable, environment-agnostic manifests customized via overlays.                |
| **applications/user-service/base/kustomization.yaml**                | Kustomize configuration referencing base manifests (deployment, service, configmap).                                       | Defines base resources for user-service, serving as the foundation for overlays.          |
| **applications/user-service/base/deployment.yaml**                   | Defines the Kubernetes Deployment for user-service (pods, images, replicas, env vars).                                     | Core deployment configuration, supports rolling updates, customized per environment.      |
| **applications/user-service/base/service.yaml**                      | Defines a Kubernetes Service for user-service to route traffic to pods.                                                    | Enables service discovery and communication within the cluster.                           |
| **applications/user-service/base/configmap.yaml**                    | Stores non-sensitive configuration data (e.g., URLs, feature flags) for user-service.                                      | Allows configuration changes without rebuilding images, customized via patches.           |
| **applications/user-service/overlays/**                              | Directory for environment-specific overlays (dev, staging, prod) for user-service.                                         | Customizes base manifests for specific environments without modifying the base.           |
| **applications/user-service/overlays/dev/**                          | Contains dev-specific overlays for user-service.                                                                           | Customizes user-service for development (e.g., lower resources, dev DB endpoints).        |
| **applications/user-service/overlays/dev/kustomization.yaml**        | Kustomize configuration for dev, referencing base manifests and applying patches.                                          | Specifies dev-specific patches for user-service.                                          |
| **applications/user-service/overlays/dev/configmap-patch.yaml**      | Patch to override base ConfigMap for dev (e.g., dev-specific URLs).                                                        | Ensures dev-specific configurations without altering the base ConfigMap.                  |
| **applications/user-service/overlays/dev/deployment-patch.yaml**     | Patch to override base Deployment for dev (e.g., fewer replicas).                                                          | Customizes deployment settings for development, optimizing resource usage.                |
| **applications/user-service/overlays/staging/**                      | Contains staging-specific overlays for user-service.                                                                       | Mimics production settings with testing tweaks for reliable pre-prod validation.          |
| **applications/user-service/overlays/staging/kustomization.yaml**    | Kustomize configuration for staging, referencing base manifests and patches.                                               | Specifies staging-specific patches for user-service.                                      |
| **applications/user-service/overlays/staging/configmap-patch.yaml**  | Patch to override base ConfigMap for staging (e.g., staging DB URLs).                                                      | Ensures staging-specific configurations align with production.                            |
| **applications/user-service/overlays/staging/deployment-patch.yaml** | Patch to override base Deployment for staging (e.g., production-like replicas).                                            | Balances testing and production readiness for user-service.                               |
| **applications/user-service/overlays/prod/**                         | Contains prod-specific overlays for user-service.                                                                          | Enforces production-grade settings for stability and performance.                         |
| **applications/user-service/overlays/prod/kustomization.yaml**       | Kustomize configuration for prod, referencing base manifests and patches.                                                  | Specifies prod-specific patches for user-service.                                         |
| **applications/user-service/overlays/prod/configmap-patch.yaml**     | Patch to override base ConfigMap for prod (e.g., prod DB URLs).                                                            | Ensures production-optimized configurations for user-service.                             |
| **applications/user-service/overlays/prod/deployment-patch.yaml**    | Patch to override base Deployment for prod (e.g., higher replicas).                                                        | Customizes deployment for production reliability and scalability.                         |
| **applications/user-service/overlays/prod/sealed-secret.yaml**       | Defines a SealedSecret for prod, encrypting sensitive data (e.g., passwords).                                              | Enhances security by encrypting secrets at rest using Bitnami Sealed Secrets.             |
| **applications/payment-service/**                                    | Directory for payment-service manifests, structured like user-service.                                                     | Manages Kubernetes resources for payment-service across environments.                     |
| **applications/gateway-service/**                                    | Directory for gateway-service manifests, structured like user-service.                                                     | Manages Kubernetes resources for gateway-service (e.g., Spring Cloud Gateway).            |
| **infrastructure/**                                                  | Directory for cluster-wide infrastructure manifests (namespaces, ingress, monitoring, security).                           | Defines shared resources used by all microservices in the cluster.                        |
| **infrastructure/namespaces/**                                       | Contains manifests for Kubernetes namespaces (dev, staging, prod).                                                         | Isolates environments for resource separation and security.                               |
| **infrastructure/namespaces/dev-namespace.yaml**                     | Defines the dev namespace for development resources.                                                                       | Isolates dev resources, applies RBAC and network policies.                                |
| **infrastructure/namespaces/staging-namespace.yaml**                 | Defines the staging namespace for pre-prod resources.                                                                      | Isolates staging resources, mirrors production setup for testing.                         |
| **infrastructure/namespaces/prod-namespace.yaml**                    | Defines the prod namespace for production resources.                                                                       | Isolates production resources, enforces strict security and resource limits.              |
| **infrastructure/ingress-controllers/**                              | Directory for ingress controller configurations (e.g., NGINX, Traefik).                                                    | Manages external traffic routing to microservices.                                        |
| **infrastructure/ingress-controllers/nginx-ingress/**                | Contains manifests for NGINX Ingress Controller.                                                                           | Routes external HTTP/HTTPS traffic, integrates with AWS ALB for load balancing.           |
| **infrastructure/ingress-controllers/traefik/**                      | Contains manifests for Traefik Ingress Controller.                                                                         | Alternative ingress controller, used for specific routing or performance needs.           |
| **infrastructure/monitoring/**                                       | Directory for monitoring tools (Prometheus, Grafana, Jaeger).                                                              | Enables observability for metrics, visualization, and distributed tracing.                |
| **infrastructure/monitoring/prometheus/**                            | Contains manifests for Prometheus deployment and configuration.                                                            | Scrapes metrics from microservices (e.g., via Spring Boot actuator endpoints).            |
| **infrastructure/monitoring/grafana/**                               | Contains manifests for Grafana deployment and dashboards.                                                                  | Visualizes Prometheus metrics for monitoring latency, errors, and performance.            |
| **infrastructure/monitoring/jaeger/**                                | Contains manifests for Jaeger deployment for distributed tracing.                                                          | Integrates with Sleuth/Zipkin for tracing request flows across microservices.             |
| **infrastructure/security/**                                         | Directory for security-related manifests (network policies, pod security, RBAC).                                           | Enhances cluster security and access control.                                             |
| **infrastructure/security/network-policies/**                        | Contains NetworkPolicy manifests to control pod ingress/egress traffic.                                                    | Enforces zero-trust networking, restricts traffic to specific namespaces/IPs.             |
| **infrastructure/security/pod-security-policies/**                   | Contains PodSecurityPolicy manifests to enforce pod-level security constraints.                                            | Ensures pods run with least privilege, restricts unsafe configurations.                   |
| **infrastructure/security/rbac/**                                    | Contains RBAC manifests for role-based access control (e.g., ServiceAccount permissions).                                  | Grants pods access to Kubernetes API, AWS resources (e.g., ECR, S3) via IRSA.             |
| **argocd/**                                                          | Directory for ArgoCD configurations to manage GitOps deployments.                                                          | Automates synchronization of Kubernetes resources with Git repository changes.            |
| **argocd/applications/**                                             | Contains ArgoCD Application manifests for each microservice and environment.                                               | Defines how ArgoCD syncs specific services and environments with Git.                     |
| **argocd/applications/user-service-dev.yaml**                        | ArgoCD Application for user-service in dev, referencing the dev overlay.                                                   | Automates deployment of user-service in the dev namespace.                                |
| **argocd/applications/user-service-staging.yaml**                    | ArgoCD Application for user-service in staging, referencing the staging overlay.                                           | Automates deployment of user-service in the staging namespace.                            |
| **argocd/applications/user-service-prod.yaml**                       | ArgoCD Application for user-service in prod, referencing the prod overlay.                                                 | Automates deployment of user-service in the prod namespace.                               |
| **argocd/applications/payment-service-dev.yaml**                     | ArgoCD Application for payment-service in dev, referencing the dev overlay.                                                | Automates deployment of payment-service in the dev namespace.                             |
| **argocd/applications/payment-service-staging.yaml**                 | ArgoCD Application for payment-service in staging, referencing the staging overlay.                                        | Automates deployment of payment-service in the staging namespace.                         |
| **argocd/applications/payment-service-prod.yaml**                    | ArgoCD Application for payment-service in prod, referencing the prod overlay.                                              | Automates deployment of payment-service in the prod namespace.                            |
| **argocd/projects/**                                                 | Directory for ArgoCD Project manifests defining access and deployment policies.                                            | Groups applications and enforces deployment constraints (e.g., allowed namespaces).       |
| **argocd/projects/microservices.yaml**                               | ArgoCD Project manifest for microservices, defining allowed repos and namespaces.                                          | Ensures consistent deployment policies across microservices.                              |
| **argocd/app-of-apps/**                                              | Directory for ArgoCD ApplicationSet or app-of-apps manifests to manage multiple applications.                              | Simplifies management of multiple microservices and environments.                         |
| **argocd/app-of-apps/dev-apps.yaml**                                 | ArgoCD ApplicationSet for all dev environment applications.                                                                | Automates deployment of all microservices in the dev namespace.                           |
| **argocd/app-of-apps/staging-apps.yaml**                             | ArgoCD ApplicationSet for all staging environment applications.                                                            | Automates deployment of all microservices in the staging namespace.                       |
| **argocd/app-of-apps/prod-apps.yaml**                                | ArgoCD ApplicationSet for all prod environment applications.                                                               | Automates deployment of all microservices in the prod namespace.                          |
| **environments/**                                                    | Directory for environment-specific Kustomize configurations and patches.                                                   | Centralizes environment-wide customizations, applied across multiple services.            |
| **environments/dev/**                                                | Contains dev environment configurations and patches.                                                                       | Customizes cluster-wide settings for the dev environment (e.g., resource limits).         |
| **environments/dev/kustomization.yaml**                              | Kustomize configuration for the dev environment, referencing patches.                                                      | Applies dev-specific customizations across services or infrastructure.                    |
| **environments/dev/patches/**                                        | Directory for dev-specific patches to customize base manifests.                                                            | Allows fine-grained adjustments for the dev environment (e.g., config overrides).         |
| **environments/staging/**                                            | Contains staging environment configurations and patches.                                                                   | Customizes cluster-wide settings for staging, mirroring production where possible.        |
| **environments/staging/kustomization.yaml**                          | Kustomize configuration for the staging environment, referencing patches.                                                  | Applies staging-specific customizations across services or infrastructure.                |
| **environments/staging/patches/**                                    | Directory for staging-specific patches to customize base manifests.                                                        | Allows fine-grained adjustments for the staging environment.                              |
| **environments/prod/**                                               | Contains prod environment configurations and patches.                                                                      | Customizes cluster-wide settings for production, ensuring stability and performance.      |
| **environments/prod/kustomization.yaml**                             | Kustomize configuration for the prod environment, referencing patches.                                                     | Applies prod-specific customizations across services or infrastructure.                   |
| **environments/prod/patches/**                                       | Directory for prod-specific patches to customize base manifests.                                                           | Allows fine-grained adjustments for the production environment.                           |

## Notes

- This repository structure leverages Kustomize for managing Kubernetes manifests and ArgoCD for GitOps, enabling
  automated, version-controlled deployments to AWS EKS.
- **Applications/** organizes microservice-specific manifests (e.g., user-service, payment-service), with **base/** for
  reusable configurations and **overlays/** for environment-specific customizations.
- **Infrastructure/** manages cluster-wide resources (namespaces, ingress controllers, monitoring, security), ensuring
  consistent setup across environments.
- **ArgoCD/** configurations enable automated synchronization of manifests with the Kubernetes cluster, supporting
  GitOps workflows with auditability and rollbacks.
- **Environments/** provides cluster-wide customizations, complementing service-specific overlays for comprehensive
  environment management.
- **Sealed Secrets** in production enhance security by encrypting sensitive data, integrated with tools like Bitnami
  Sealed Secrets.
- For specific file examples (e.g., `kustomization.yaml`, `sealed-secret.yaml`, or `app-of-apps/dev-apps.yaml`),
  detailed artifacts can be provided upon request, similar to those in prior responses.